config:
  pulumi-hcloud-kube-hetzner:network:
    hetzner:
      enabled: true
      # It is highly recommended to set a cidr for the private network for at least /20
      cidr: 192.168.16.0/20
    wireguard:
      enabled: true
      firewall:
        hetzner:
          # Allow establish tunnel only from the this cidr!
          # Remember: it only affects external network. Nodes in the internal network can establish tunnels from any ip
          # because THEY consider the private networks to be "secure".
          # Remember: all traffic between nodes is allowed.
          allowed-ips:
            - '102.0.0.0/8'
  pulumi-hcloud-kube-hetzner:k8s:
    kube-api-endpoint:
      # By default, public endpoint type is used.
      # type: public
      firewall:
        # This only works for the public endpoint.
        hetzner-public:
          # Allow access to the k8s api from the this cidr!
          allowed-ips:
            - '0.0.0.0/0'

  pulumi-hcloud-kube-hetzner:nodepools:
    agents:
      - id: 01-small-nodes
        config:
          server:
            firewall:
              hetzner:
                # You should explicitly enable firewall for every layer of the configuration.
                enabled: true
                # Do not allow ping only this server node explicitly.
                allow-icmp: false
                additional-rules: 
                  - description: custom rule
                    port: "100"
                    protocol: tcp
                    sourceIps:
                      - 0.0.0.0/0
        nodes:
          - id: k3s-agent01
      - id: 02-small-nodes
        nodes:
          - id: k3s-agent02
    servers:
      - id: control-plane
        nodes:
        - id: k3s-server01
          leader: true
          server:
            firewall:
              hetzner:
                # You should explicitly enable firewall for every layer of the configuration.
                enabled: true
                # Do not allow ping only this server node explicitly.
                allow-icmp: false
              ssh:
                # You should explicitly enable ssh for every layer of the configuration.
                # If you need it of course
                allow: true
            location: fsn1
  pulumi-hcloud-kube-hetzner:defaults:
    agents:
      server:
        firewall:
          hetzner:
            # You should explicitly enable firewall for every layer of the configuration.
            enabled: true
            # You should explicitly enable ping for every layer of the configuration.
            allow-icmp: true
            ssh:
              # You should explicitly enable ssh for every layer of the configuration.
              # If you need it of course
              allow: true
            # Append (!) to additional rules this rule for agent nodes only.
            additional-rules:
              - description: custom rule
                port: "10000"
                protocol: tcp
                sourceIps:
                  - 0.0.0.0/0
    global:
      server:
        firewall:
          firewalld:
            enabled: false
          hetzner:
            enabled: true
            allow-icmp: true
            ssh:
              allow: true
              allowed-ips:
                - '0.0.0.0/0'
            additional-rules:
              - description: custom rule
                port: "51825"
                protocol: udp
                sourceIps:
                  - 102.0.0.0/8
                  - ::/0
      k3s:
        version: v1.26.4+k3s1
    servers:
      k3s:
        config:
          disable:
            - metrics-server
            - traefik
            - servicelb
